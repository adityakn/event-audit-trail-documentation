<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Event-audit-trail-documentation : Documentation for Event Audit Trail Service">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Event-audit-trail-documentation</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/emerging-verticals-docs/event-audit-trail-documentation">View on GitHub</a>

          <h1 id="project_title">Event-audit-trail-documentation</h1>
          <h2 id="project_tagline">Documentation for Event Audit Trail Service</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/emerging-verticals-docs/event-audit-trail-documentation/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/emerging-verticals-docs/event-audit-trail-documentation/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="event-audit-trail" class="anchor" href="#event-audit-trail" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Event-Audit-Trail</h1>

<p>The Predix Event Audit Trail Service is an data persistence service that represents user-defined data and states as events stored in a chronological manner.  The service provides a simple and scalable way to provide an audit trail for user applications.  The Predix Event Audit Trail is available as a service tile in the Predix Cloud and allows users to create, search, update, and delete events through a REST interface. </p>

<h2>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table of Contents</h2>

<ul>
<li>
<a href="#usage">Usage</a>

<ul>
<li><a href="#creating-service-instance">Creating service instance</a></li>
<li><a href="#auto-archive">Auto archive</a></li>
</ul>
</li>
<li>
<a href="#event-service">Event service</a>

<ul>
<li><a href="#get-events-with-filters">Get events with filters</a></li>
<li><a href="#get-event-by-uuid">Get event by uuid</a></li>
<li><a href="#add-events">Add events</a></li>
<li><a href="#update-events">Update events</a></li>
<li><a href="#delete-event">Delete event</a></li>
<li><a href="#search-events">Search events</a></li>
<li><a href="#get-tenant">Get Tenant</a></li>
</ul>
</li>
<li>
<a href="#archive-service">Archive service</a>

<ul>
<li><a href="#get-archive-configuration">Get archive configuration</a></li>
<li><a href="#sets-or-updates-the-archive-configuration">Sets or updates the archive configuration</a></li>
<li><a href="#get-archive-list">Get archive list</a></li>
<li><a href="#get-staged-events">Get staged events</a></li>
<li><a href="#get-archive-by-uuid">Get archive by uuid</a></li>
</ul>
</li>
<li><a href="#response-codes">Response codes</a></li>
<li><a href="#resources">Resources</a></li>
</ul>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a id="creating-service-instance" class="anchor" href="#creating-service-instance" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating service instance</h3>

<p>To create an instance of the Predix Event Audit Trail Service, please use the <a href="https://github.com/cloudfoundry/cli">Cloud Foundry CLI tool</a> to run the following command:</p>

<pre><code>cf create-service predix-event-audit-trail &lt;plan&gt; &lt;service_instance_name&gt; -c '{“trustedIssuerId”: “&lt;predix uaa instance url&gt;/oauth/token”}'
</code></pre>

<p>Once a service instance is created , you will be issued a tenant uuid for the created service instance.  You can obtain this tenant uuid by binding an application to
the service instance.  You can bind an application to the service instance with the following command:</p>

<pre><code>cf bind-service &lt;app_name&gt; &lt;service_instance_name&gt;
</code></pre>

<p>The application's <em>VCAP SERVICES</em> will contain the following variables:</p>

<pre><code>"predix-event-audit-trail": [
   {
    "credentials": {
     "catalog-uri": "&lt;service url&gt;",
     "tenant-uuid": "&lt;tenant uuid&gt;",
     "version": "1",
      "trusted-issuer-ids": "&lt;trusted issuers&gt;",
     "zone-oauth-scope": "event-audit-trail.zone.&lt;tenant uuid&gt;.user"
    },
    "label": "predix-event-audit-trail",
    "name": "&lt;service_instance_name&gt;",
    "plan": "&lt;plan&gt;",
    "provider": null,
    "syslog_drain_url": null,
    "tags": [
     "audit",
     "event",
     "trail"
    ]
   }
</code></pre>

<p>You can then use the <a href="#event-apis">service APIs</a> with using the <strong></strong> as the base url.</p>

<p><strong>Note</strong> - Please update your <a href="https://github.com/cloudfoundry/cli">Cloud Foundry CLI tool</a> to the lastest version.</p>

<h3>
<a id="auto-archive" class="anchor" href="#auto-archive" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Auto archive</h3>

<p>The Event Audit Trail Service has built-in archiving feature.  To use this feature, please configure the event limit using the <a href="#sets-or-updates-the-archive-configuration">Sets archive configuration api</a>.</p>

<p>Events that are marked for archival will be disabled and moved to a "staging" area.  These events will not be fully archived until there are 50 events in the "staging" area.  You can retrieve "staged" events using the <a href="#get-staged-events">Get staged events</a> API.  Once events have been fully archived they must be retrieved using the <a href="#get-archive-by-uuid">Get archive by uuid</a> API.  </p>

<p>Archived and staged events will not be returned by the service using the standard get event API.  Please note that archived and staged events still count against the total event usage for billing.</p>

<h2>
<a id="event-service" class="anchor" href="#event-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Event service</h2>

<h3>
<a id="get-events-by-tenant-with-filters" class="anchor" href="#get-events-by-tenant-with-filters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get events by tenant with filters</h3>

<ul>
<li>
<p>GET /tenants/{tenant_uuid}/events?context=&amp;tag=&amp;classification=&amp;start_date=&amp;end_date=</p>

<ul>
<li>parameters

<ul>
<li>tenant_uuid - uuid of tenant</li>
</ul>
</li>
<li>filters

<ul>
<li>context - events by context</li>
<li>tag - events by tag</li>
<li>classification - filters events by classification</li>
<li>start_date - filters events by start_date in the format: <strong>yyyy-M-d h<g-emoji alias="m" fallback-src="https://assets-cdn.github.com/images/icons/emoji/unicode/24c2.png">Ⓜ️</g-emoji>s</strong>, inclusive. If a start_date is supplied, an end_date must also be supplied.</li>
<li>end_date - filters events by end_date in the format: <strong>yyyy-M-d h<g-emoji alias="m" fallback-src="https://assets-cdn.github.com/images/icons/emoji/unicode/24c2.png">Ⓜ️</g-emoji>s</strong>, exclusive. If a end_date is supplied, an start_date must also be supplied.</li>
</ul>
</li>
</ul>
</li>
<li><p>Sample Response Payload</p></li>
</ul>

<pre><code>  "payload": [
    {
      "id": 12,
      "uuid": "0730853b-6a5b-4894-b6da-e7e88833f1e9",
      "tenantUuid": null,
      "context": "user test",
      "tag": "group2",
      "classification": 0,
      "enabled": true,
      "timestamp": 1459378121815,
      "data": "{\"name\": \"test1.csv\"}"
    },
    {
          "id": 12,
          "uuid": "0730853b-6a5b-4894-b6da-e7e88833f1e9",
          "tenantUuid": null,
          "context": "user test",
          "tag": "group2",
          "classification": 0,
          "enabled": true,
          "timestamp": 1459378121815,
          "data": "{\"name\": \"test2.csv\"}"
     }
  ],
  "uuid": "ddc7f50a-6883-45aa-a823-b70e47d2a05c",
  "status": 1000,
  "message": "OK",
  "timestamp": 1459470908881
</code></pre>

<h3>
<a id="get-event-by-uuid" class="anchor" href="#get-event-by-uuid" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get event by uuid</h3>

<ul>
<li>
<p>GET tenant/{tenant_uuid}/events/{uuid}</p>

<ul>
<li>parameters

<ul>
<li>tenant_uuid - uuid of tenant</li>
<li>uuid - uuid of the event (REQUIRED)</li>
</ul>
</li>
</ul>
</li>
<li><p>Sample Response Payload</p></li>
</ul>

<pre><code>  "payload": [
    {
      "id": 12,
      "uuid": "0730853b-6a5b-4894-b6da-e7e88833f1e9",
      "tenantUuid": null,
      "context": "user test",
      "tag": "group2",
      "classification": 0,
      "enabled": true,
      "timestamp": 1459378121815,
      "data": "{\"name\": \"test1.csv\"}"
    },
  ],
  "uuid": "ddc7f50a-6883-45aa-a823-b70e47d2a05c",
  "status": 1000,
  "message": "OK",
  "timestamp": 1459470908881
</code></pre>

<h3>
<a id="add-events" class="anchor" href="#add-events" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add events</h3>

<ul>
<li>
<p>POST tenants/{tenant_uuid}/events</p>

<ul>
<li>Request Body JSON parameters

<ul>
<li>tenantUuid - uuid of tenant, this is the primary method of tag events (REQUIRED)</li>
<li>context - user-defined context (OPTIONAL)</li>
<li>tag - user-defined tag (OPTIONAL)</li>
<li>classification - user-defined classification (OPTIONAL)</li>
<li>timestamp - if no timestamp is given, this will be set to the current time (OPTIONAL)</li>
<li>data - user-defined JSON data field (OPTIONAL)</li>
</ul>
</li>
</ul>
</li>
<li><p>Sample Request</p></li>
</ul>

<pre><code>[
    {
      "context": "user test",
      "tag": "tag1",
      "classification": 0,
      "data": "{\"name\": \"event1\",\"type\": \"request\",\"params\": \"test\"}"
    }
  ]
</code></pre>

<h3>
<a id="update-event" class="anchor" href="#update-event" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update event</h3>

<ul>
<li>
<p>PUT tenants/{tenant_uuid}/events/{uuid}</p>

<ul>
<li>URI path parameters

<ul>
<li>tenant_uuid - uuid of tenant</li>
<li>uuid - uuid of the event (REQUIRED)</li>
</ul>
</li>
<li>Request Body JSON parameters - Event details will be over-ridden.

<ul>
<li>context - user-defined context (OPTIONAL)</li>
<li>tenantUuid - uuid of tenant (OPTIONAL)</li>
<li>tag - user-defined tag (OPTIONAL)</li>
<li>classification - user-defined classification (OPTIONAL)</li>
<li>timestamp - if no timestamp is given, this will be set to the current time (OPTIONAL)</li>
<li>data - user-defined JSON data field (OPTIONAL)</li>
</ul>
</li>
</ul>
</li>
<li><p>Sample Response Payload</p></li>
</ul>

<pre><code>  "payload": [
    {
      "id": 12,
      "uuid": "0730853b-6a5b-4894-b6da-e7e88833f1e9",
      "tenantUuid": null,
      "context": "user test",
      "tag": "group2",
      "classification": 0,
      "enabled": true,
      "timestamp": 1459378121815,
      "data": "{\"name\": \"test1.csv\"}"
    },
  ],
  "uuid": "ddc7f50a-6883-45aa-a823-b70e47d2a05c",
  "status": 1000,
  "message": "OK",
  "timestamp": 1459470908881
</code></pre>

<h3>
<a id="delete-event" class="anchor" href="#delete-event" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Delete event</h3>

<ul>
<li>
<p>DELETE tenants/{tenant_uuid}/events/{uuid}</p>

<ul>
<li>parameters

<ul>
<li>tenant_uuid - uuid of tenant</li>
<li>uuid - uuid of the event (REQUIRED)</li>
</ul>
</li>
</ul>
</li>
<li><p>Sample Response Payload</p></li>
</ul>

<pre><code>  "payload": [
    {
      "id": 12,
      "uuid": "0730853b-6a5b-4894-b6da-e7e88833f1e9",
      "tenantUuid": null,
      "context": "user test",
      "tag": "group2",
      "classification": 0,
      "enabled": true,
      "timestamp": 1459378121815,
      "data": "{\"name\": \"test1.csv\"}"
    },
  ],
  "uuid": "ddc7f50a-6883-45aa-a823-b70e47d2a05c",
  "status": 1000,
  "message": "OK",
  "timestamp": 1459470908881
</code></pre>

<h3>
<a id="search-events" class="anchor" href="#search-events" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Search events</h3>

<ul>
<li>
<p>GET tenants/{tenant_uuid}/event-search?query=</p>

<ul>
<li>parameters

<ul>
<li>tenant_uuid - uuid of tenant </li>
</ul>
</li>
<li>filter

<ul>
<li>query - search query<br>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Search Terms Example</p></li>
</ul>

<pre><code>* query=NOT removed - Get all the events audit-trails if event doesn't contains "removed".
* query=added - Get all the events audit-trails if event contains "added".
* query=added OR removed - Get all the events audit-trails if event contains "added" or "removed".
* query=added AND removed - Get all the events audit-trails if event contains "added" and "removed".
</code></pre>

<ul>
<li>Sample Response Payload</li>
</ul>

<pre><code>  "payload": [
    {
      "id": 12,
      "uuid": "0730853b-6a5b-4894-b6da-e7e88833f1e9",
      "tenantUuid": null,
      "context": "user test",
      "tag": "group2",
      "classification": 0,
      "enabled": true,
      "timestamp": 1459378121815,
      "data": "{\"name\": \"test1.csv\"}"
    },
  ],
  "uuid": "ddc7f50a-6883-45aa-a823-b70e47d2a05c",
  "status": 1000,
  "message": "OK",
  "timestamp": 1459470908881
</code></pre>

<h3>
<a id="get-tenant" class="anchor" href="#get-tenant" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get Tenant</h3>

<ul>
<li>
<p>GET tenant/{tenant_uuid}</p>

<ul>
<li>parameters

<ul>
<li>tenant_uuid - uuid of tenant to retrieve</li>
</ul>
</li>
</ul>
</li>
<li><p>Sample Response Payload</p></li>
</ul>

<pre><code>   "payload": {
     "id": 1231,
     "bindingId": "2d5a2ef5-898f-4f3d-80fd-d9266992f99f",
     "uuid": "e314ec8d9-66dc-4782-91d6-634551f492c5",
     "timestamp": 1463508805471,
     "eventCount": 250,
     "trustedIssuers": "https://89cd1af4-be74-4c39-9282-8fef95011afa.predix-uaa.run.aws-usw02-pr.ice.predix.io/oauth/token\n"
   },
   "uuid": "cf6321bc-4be8-48bd-8058-71602fc78f63",
   "status": 1000,
   "message": "OK",
   "timestamp": 1466015044971
</code></pre>

<h2>
<a id="archive-service" class="anchor" href="#archive-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Archive service</h2>

<h3>
<a id="get-archive-configuration" class="anchor" href="#get-archive-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get archive configuration</h3>

<ul>
<li>
<p>GET archive/tenant/{tenant_uuid}/configuration</p>

<ul>
<li>parameters

<ul>
<li>tenant_uuid - tenant uuid (primary event grouping)</li>
</ul>
</li>
</ul>
</li>
<li><p>Sample Response Payload</p></li>
</ul>

<pre><code>  "payload": {
    "uuid": "77173278-2ba0-457b-b660-09f9a9c87855",
    "tenantUuid": "4b2b0ad4-c54b-4e69-90b1-12d73e36662c",
    "maximumNumberOfEvents": 5,
    "maximumNumberOfStoredEventsDays": -1
  }
</code></pre>

<h3>
<a id="sets-or-updates-the-archive-configuration" class="anchor" href="#sets-or-updates-the-archive-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sets or updates the archive configuration</h3>

<ul>
<li>
<p>POST archive/tenant/{tenant_uuid}/configuration</p>

<ul>
<li>parameters

<ul>
<li>Request Body JSON parameters

<ul>
<li>maximumNumberOfEvents - Maximum number of events to retain (Default=-1)</li>
<li>maximumNumberOfStoredEventsDays - Maximum numbers of days of events to retain (Default=-1)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Sample Request</p></li>
</ul>

<pre><code>{
  "maximumNumberOfEvents": 100,
  "maximumNumberOfStoredEventsDays": 30
}
</code></pre>

<h3>
<a id="get-archive-list" class="anchor" href="#get-archive-list" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get archive list</h3>

<ul>
<li>
<p>GET archive/tenant/{tenant_uuid}/archives</p>

<ul>
<li>parameters
    * tenant_uuid - tenant uuid (primary event grouping)</li>
</ul>
</li>
<li><p>Sample Response Payload</p></li>
</ul>

<pre><code>"payload" : [
    {
      "id": 11,
      "uuid": "e006f214-88a6-424b-9a7d-f43180aba455",
      "tenantUuid": "4b2b0ad4-c54b-4e69-90b1-12d73e36662c",
      "fromDate": 1461800406677,
      "toDate": 1461865172861,
      "size": 20
    }]
</code></pre>

<h3>
<a id="get-staged-events" class="anchor" href="#get-staged-events" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get staged events</h3>

<ul>
<li>PUT archive/tenant/{tenant_uuid}/staged-events

<ul>
<li>URI path parameters

<ul>
<li>tenant_uuid - tenant uuid (primary event grouping)</li>
</ul>
</li>
</ul>
</li>
<li>Sample Response Payload</li>
</ul>

<pre><code>  "payload": [
    {
      "id": 12,
      "uuid": "0730853b-6a5b-4894-b6da-e7e88833f1e9",
      "tenantUuid": null,
      "context": "user test",
      "tag": "group2",
      "classification": 0,
      "enabled": true,
      "timestamp": 1459378121815,
      "data": "{\"name\": \"test1.csv\"}"
    },
  ],
  "uuid": "ddc7f50a-6883-45aa-a823-b70e47d2a05c",
  "status": 1000,
  "message": "OK",
  "timestamp": 1459470908881
</code></pre>

<h3>
<a id="get-archive-by-uuid" class="anchor" href="#get-archive-by-uuid" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get archive by uuid</h3>

<ul>
<li>PUT archive/tenant/{tenant_uuid}/archives/{uuid}

<ul>
<li>URI path parameters

<ul>
<li>tenant_uuid - tenant uuid (primary event grouping)</li>
<li>uuid - uuid of the archive (REQUIRED)</li>
</ul>
</li>
</ul>
</li>
<li>Sample Response Payload</li>
</ul>

<pre><code>  "payload": [
    {
      "id": 12,
      "uuid": "0730853b-6a5b-4894-b6da-e7e88833f1e9",
      "tenantUuid": null,
      "context": "user test",
      "tag": "group2",
      "classification": 0,
      "enabled": true,
      "timestamp": 1459378121815,
      "data": "{\"name\": \"test1.csv\"}"
    },
  ],
  "uuid": "ddc7f50a-6883-45aa-a823-b70e47d2a05c",
  "status": 1000,
  "message": "OK",
  "timestamp": 1459470908881
</code></pre>

<h2>
<a id="response-codes" class="anchor" href="#response-codes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Response codes</h2>

<p>These are the service-specific responses embedded in service responses</p>

<ul>
<li>
<strong>1000</strong> - OK</li>
<li>
<strong>1001</strong> - Event does not exist</li>
<li>
<strong>1002</strong> - Event Owner does not exist</li>
<li>
<strong>1003</strong> - Event Tenant does not exist</li>
<li>
<strong>1004</strong> - Event Owner is missing or blank</li>
<li>
<strong>1005</strong> - Encountered exception adding events</li>
<li>
<strong>1006</strong> - Tenant ID mismatch</li>
<li>
<strong>1007</strong> - Tenant is missing or blank</li>
<li>
<strong>1008</strong> - Search query is missing or blank</li>
<li>
<strong>1009</strong> - Invalid search query string</li>
<li>
<strong>1101</strong> - The archive does not exist</li>
</ul>

<h2>
<a id="resources" class="anchor" href="#resources" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Resources</h2>

<ul>
<li><p><a href="https://github.build.ge.com/emerging-verticals/event-audit-trail-sdk">Event Audit Trail SDK</a> - The accompanying SDK for the event audit-trail.</p></li>
<li><p><a href="https://github.build.ge.com/emerging-verticals/event-audit-trail-sample">Event Audit Trail Sample Application</a> - A sample application which utilizes the Event Audit Trail Service</p></li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Event-audit-trail-documentation maintained by <a href="https://github.com/emerging-verticals-docs">emerging-verticals-docs</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
