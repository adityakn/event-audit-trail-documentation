{
  "name": "Event-audit-trail-documentation",
  "tagline": "Documentation for Event Audit Trail Service",
  "body": "# Event-Audit-Trail\r\n\r\nThe Predix Event Audit Trail Service is an data persistence service that represents user-defined data and states as events stored in a chronological manner.  The service provides a simple and scalable way to provide an audit trail for user applications.  The Predix Event Audit Trail is available as a service tile in the Predix Cloud and allows users to create, search, update, and delete events through a REST interface. \r\n\r\n## Table of Contents\r\n  - [Usage](#usage)\r\n    - [Creating service instance](#creating-service-instance)\r\n    - [Auto archive](#auto-archive)\r\n    - [UAA configuration](#uaa-configuration)\r\n        - [Client credentials](#client-credentials)\r\n        - [User login](#user-login)\r\n  - [Event service](#event-service)\r\n    - [Get events with filters](#get-events-with-filters)\r\n    - [Get event by uuid](#get-event-by-uuid)\r\n    - [Add events](#add-events)\r\n    - [Update events](#update-events)\r\n    - [Delete event](#delete-event)\r\n    - [Search events](#search-events)\r\n    - [Get Tenant](#get-tenant)\r\n  - [Archive service](#archive-service)\r\n    - [Get archive configuration](#get-archive-configuration)\r\n    - [Sets or updates the archive configuration](#sets-or-updates-the-archive-configuration)\r\n    - [Get archive list](#get-archive-list)\r\n    - [Get staged events](#get-staged-events)\r\n    - [Get archive by uuid](#get-archive-by-uuid)\r\n  - [Response codes](#response-codes)\r\n  - [Resources](#resources)\r\n\r\n## Usage\r\n\r\n### Creating service instance\r\n\r\n\r\nTo create an instance of the Predix Event Audit Trail Service, please use the [Cloud Foundry CLI tool](https://github.com/cloudfoundry/cli) to run the following command:\r\n\r\n```\r\ncf create-service event-audit-trail <plan> <service_instance_name> -c '{“trustedIssuerId”: “<predix uaa instance url>/oauth/token”}'\r\n```\r\n\r\nOnce a service instance is created , you will be issued a tenant uuid for the created service instance.  You can obtain this tenant uuid by binding an application to\r\nthe service instance.  You can bind an application to the service instance with the following command:\r\n\r\n```\r\ncf bind-service <app_name> <service_instance_name>\r\n```\r\n\r\nThe application's *VCAP SERVICES* will contain the following variables:\r\n\r\n```\r\n\"event-audit-trail\": [\r\n   {\r\n    \"credentials\": {\r\n     \"catalog-uri\": \"<service url>\",\r\n     \"tenant-uuid\": \"<tenant uuid>\",\r\n     \"version\": \"1\",\r\n     \"trusted-issuer-ids\": \"<trusted issuers>\",\r\n     \"zone-oauth-scope\": \"event-audit-trail.zone.<tenant uuid>.user\"\r\n    },\r\n    \"label\": \"event-audit-trail\",\r\n    \"name\": \"<service_instance_name>\",\r\n    \"plan\": \"<plan>\",\r\n    \"provider\": null,\r\n    \"syslog_drain_url\": null,\r\n    \"tags\": [\r\n     \"audit\",\r\n     \"event\",\r\n     \"trail\"\r\n    ]\r\n   }\r\n```\r\n\r\nYou can then use the [service APIs](#event-apis) with using the **<service_url>** as the base url.\r\n\r\n**Note** - Please update your [Cloud Foundry CLI tool](https://github.com/cloudfoundry/cli) to the lastest version.\r\n\r\n#### UAA configuration\r\n\r\nOnce a tenant uuid has been issued to your instance you will need to add the **zone-oath-scope** to your UAA instance clients.\r\n\r\n##### Client credentials \r\n\r\nTo use the event audit trail service with the client credentials flow (the SDK requires this), then you need to add the **zone-oath-scope** to your client authorities.  You can do this using the UAA cli with the following command:\r\n\r\n```\r\nuaac client update <client_name> --authorities \"<list_of_authorities> event-audit-trail.zone.<tenant uuid>.user\"\r\n```\r\n\r\nTokens issue by this client will now be authorized to use the event audit trail service instance.\r\n\r\n##### User login\r\n\r\nTo use the event audit service with a user-authenticated flow (e.g. predix-seed), you will need to add a group with the proper scope using the UAA cli.\r\n\r\n```\r\nuaac client update <client_name> --scope \"<list_of_scope> event-audit-trail.zone.<tenant uuid>.user\"\r\n\r\nuaac group add event-audit-trail.zone.<tenant uuid>.user\r\n\r\nuaac member add event-audit-trail.zone.<tenant uuid>.user <users...>\r\n```\r\n\r\nNow tokens issued to this user will be authorized to use the event audit trail service instance.\r\n\r\n### Auto archive\r\n\r\nThe Event Audit Trail Service has built-in archiving feature.  To use this feature, please configure the event limit using the [Sets archive configuration api](#sets-or-updates-the-archive-configuration).\r\n\r\nEvents that are marked for archival will be disabled and moved to a \"staging\" area.  These events will not be fully archived until there are 50 events in the \"staging\" area.  You can retrieve \"staged\" events using the [Get staged events](#get-staged-events) API.  Once events have been fully archived they must be retrieved using the [Get archive by uuid](#get-archive-by-uuid) API.  \r\n\r\nArchived and staged events will not be returned by the service using the standard get event API.  Please note that archived and staged events still count against the total event usage for billing.\r\n  \r\n## Event service\r\n\r\n### Get events by tenant with filters\r\n* GET /tenants/{tenant_uuid}/events?context=<context>&tag=<tag>&classification=<classification>&start_date=<start_date>&end_date=<end_date>\r\n    * parameters\r\n        * tenant_uuid - uuid of tenant\r\n    * filters\r\n        * context - events by context\r\n        * tag - events by tag\r\n        * classification - filters events by classification\r\n        * start_date - filters events by start_date in the format: **yyyy-M-d h:m:s**, inclusive. If a start_date is supplied, an end_date must also be supplied.\r\n        * end_date - filters events by end_date in the format: **yyyy-M-d h:m:s**, exclusive. If a end_date is supplied, an start_date must also be supplied.\r\n\r\n* Sample Response Payload\r\n```\r\n  \"payload\": [\r\n    {\r\n      \"id\": 12,\r\n      \"uuid\": \"0730853b-6a5b-4894-b6da-e7e88833f1e9\",\r\n      \"tenantUuid\": null,\r\n      \"context\": \"user test\",\r\n      \"tag\": \"group2\",\r\n      \"classification\": 0,\r\n      \"enabled\": true,\r\n      \"timestamp\": 1459378121815,\r\n      \"data\": \"{\\\"name\\\": \\\"test1.csv\\\"}\"\r\n    },\r\n    {\r\n          \"id\": 12,\r\n          \"uuid\": \"0730853b-6a5b-4894-b6da-e7e88833f1e9\",\r\n          \"tenantUuid\": null,\r\n          \"context\": \"user test\",\r\n          \"tag\": \"group2\",\r\n          \"classification\": 0,\r\n          \"enabled\": true,\r\n          \"timestamp\": 1459378121815,\r\n          \"lastUpdated\": 1459378121815,\r\n          \"data\": \"{\\\"name\\\": \\\"test2.csv\\\"}\"\r\n     }\r\n  ],\r\n  \"uuid\": \"ddc7f50a-6883-45aa-a823-b70e47d2a05c\",\r\n  \"status\": 1000,\r\n  \"message\": \"OK\",\r\n  \"timestamp\": 1459470908881\r\n```\r\n\r\n### Get event by uuid\r\n* GET tenant/{tenant_uuid}/events/{uuid}\r\n    * parameters\r\n        * tenant_uuid - uuid of tenant\r\n        * uuid - uuid of the event (REQUIRED)\r\n\r\n* Sample Response Payload\r\n```\r\n  \"payload\": [\r\n    {\r\n      \"id\": 12,\r\n      \"uuid\": \"0730853b-6a5b-4894-b6da-e7e88833f1e9\",\r\n      \"tenantUuid\": null,\r\n      \"context\": \"user test\",\r\n      \"tag\": \"group2\",\r\n      \"classification\": 0,\r\n      \"enabled\": true,\r\n      \"timestamp\": 1459378121815,\r\n      \"lastUpdated\": 1459378121815,\r\n      \"data\": \"{\\\"name\\\": \\\"test1.csv\\\"}\"\r\n    },\r\n  ],\r\n  \"uuid\": \"ddc7f50a-6883-45aa-a823-b70e47d2a05c\",\r\n  \"status\": 1000,\r\n  \"message\": \"OK\",\r\n  \"timestamp\": 1459470908881\r\n```\r\n\r\n### Add events\r\n* POST tenants/{tenant_uuid}/events\r\n    * Request Body JSON parameters\r\n        * tenantUuid - uuid of tenant, this is the primary method of tag events (REQUIRED)\r\n        * context - user-defined context (OPTIONAL)\r\n        * tag - user-defined tag (OPTIONAL)\r\n        * classification - user-defined classification (OPTIONAL)\r\n        * timestamp - if no timestamp is given, this will be set to the current time (OPTIONAL)\r\n        * data - user-defined JSON data field (OPTIONAL)\r\n\r\n* Sample Request\r\n```\r\n[\r\n    {\r\n      \"context\": \"user test\",\r\n      \"tag\": \"tag1\",\r\n      \"classification\": 0,\r\n      \"data\": \"{\\\"name\\\": \\\"event1\\\",\\\"type\\\": \\\"request\\\",\\\"params\\\": \\\"test\\\"}\"\r\n    }\r\n  ]\r\n```\r\n\r\n### Update event\r\n* PUT tenants/{tenant_uuid}/events/{uuid}\r\n    * URI path parameters\r\n        * tenant_uuid - uuid of tenant\r\n        * uuid - uuid of the event (REQUIRED)\r\n    * Request Body JSON parameters - Event details will be over-ridden.\r\n         * context - user-defined context (OPTIONAL)\r\n         * tenantUuid - uuid of tenant (OPTIONAL)\r\n         * tag - user-defined tag (OPTIONAL)\r\n         * classification - user-defined classification (OPTIONAL)\r\n         * timestamp - if no timestamp is given, this will be set to the current time (OPTIONAL)\r\n         * data - user-defined JSON data field (OPTIONAL)\r\n\r\n* Sample Response Payload\r\n```\r\n  \"payload\": [\r\n    {\r\n      \"id\": 12,\r\n      \"uuid\": \"0730853b-6a5b-4894-b6da-e7e88833f1e9\",\r\n      \"tenantUuid\": null,\r\n      \"context\": \"user test\",\r\n      \"tag\": \"group2\",\r\n      \"classification\": 0,\r\n      \"enabled\": true,\r\n      \"timestamp\": 1459378121815,\r\n      \"lastUpdated\": 1459378121815,\r\n      \"data\": \"{\\\"name\\\": \\\"test1.csv\\\"}\"\r\n    },\r\n  ],\r\n  \"uuid\": \"ddc7f50a-6883-45aa-a823-b70e47d2a05c\",\r\n  \"status\": 1000,\r\n  \"message\": \"OK\",\r\n  \"timestamp\": 1459470908881\r\n```\r\n\r\n### Delete event\r\n* DELETE tenants/{tenant_uuid}/events/{uuid}\r\n    * parameters\r\n        * tenant_uuid - uuid of tenant\r\n        * uuid - uuid of the event (REQUIRED)\r\n\r\n* Sample Response Payload\r\n```\r\n  \"payload\": [\r\n    {\r\n      \"id\": 12,\r\n      \"uuid\": \"0730853b-6a5b-4894-b6da-e7e88833f1e9\",\r\n      \"tenantUuid\": null,\r\n      \"context\": \"user test\",\r\n      \"tag\": \"group2\",\r\n      \"classification\": 0,\r\n      \"enabled\": true,\r\n      \"timestamp\": 1459378121815,\r\n      \"lastUpdated\": 1459378121815,\r\n      \"data\": \"{\\\"name\\\": \\\"test1.csv\\\"}\"\r\n    },\r\n  ],\r\n  \"uuid\": \"ddc7f50a-6883-45aa-a823-b70e47d2a05c\",\r\n  \"status\": 1000,\r\n  \"message\": \"OK\",\r\n  \"timestamp\": 1459470908881\r\n```\r\n\r\n### Search events\r\n* GET tenants/{tenant_uuid}/event-search?query=<search_query>\r\n    * parameters\r\n        * tenant_uuid - uuid of tenant \r\n    * filter\r\n        * query - search query    \r\n    \r\n* Search Terms Example\r\n```\r\n* query=NOT removed - Get all the events audit-trails if event doesn't contains \"removed\".\r\n* query=added - Get all the events audit-trails if event contains \"added\".\r\n* query=added OR removed - Get all the events audit-trails if event contains \"added\" or \"removed\".\r\n* query=added AND removed - Get all the events audit-trails if event contains \"added\" and \"removed\".\r\n```\r\n\r\n* Sample Response Payload\r\n```\r\n  \"payload\": [\r\n    {\r\n      \"id\": 12,\r\n      \"uuid\": \"0730853b-6a5b-4894-b6da-e7e88833f1e9\",\r\n      \"tenantUuid\": null,\r\n      \"context\": \"user test\",\r\n      \"tag\": \"group2\",\r\n      \"classification\": 0,\r\n      \"enabled\": true,\r\n      \"timestamp\": 1459378121815,\r\n      \"lastUpdated\": 1459378121815,\r\n      \"data\": \"{\\\"name\\\": \\\"test1.csv\\\"}\"\r\n    },\r\n  ],\r\n  \"uuid\": \"ddc7f50a-6883-45aa-a823-b70e47d2a05c\",\r\n  \"status\": 1000,\r\n  \"message\": \"OK\",\r\n  \"timestamp\": 1459470908881\r\n```\r\n\r\n### Get Tenant\r\n* GET tenant/{tenant_uuid}\r\n    * parameters\r\n        * tenant_uuid - uuid of tenant to retrieve\r\n\r\n* Sample Response Payload\r\n```\r\n   \"payload\": {\r\n     \"id\": 1231,\r\n     \"bindingId\": \"2d5a2ef5-898f-4f3d-80fd-d9266992f99f\",\r\n     \"uuid\": \"e314ec8d9-66dc-4782-91d6-634551f492c5\",\r\n     \"timestamp\": 1463508805471,\r\n     \"eventCount\": 250,\r\n     \"trustedIssuers\": \"https://89cd1af4-be74-4c39-9282-8fef95011afa.predix-uaa.run.aws-usw02-pr.ice.predix.io/oauth/token\\n\"\r\n   },\r\n   \"uuid\": \"cf6321bc-4be8-48bd-8058-71602fc78f63\",\r\n   \"status\": 1000,\r\n   \"message\": \"OK\",\r\n   \"timestamp\": 1466015044971\r\n```\r\n\r\n## Archive service\r\n\r\n### Get archive configuration\r\n* GET archive/tenant/{tenant_uuid}/configuration\r\n    * parameters\r\n        * tenant_uuid - tenant uuid (primary event grouping)\r\n\r\n* Sample Response Payload\r\n```\r\n  \"payload\": {\r\n    \"uuid\": \"77173278-2ba0-457b-b660-09f9a9c87855\",\r\n    \"tenantUuid\": \"4b2b0ad4-c54b-4e69-90b1-12d73e36662c\",\r\n    \"maximumNumberOfEvents\": 5,\r\n    \"maximumNumberOfStoredEventsDays\": -1\r\n  }\r\n```\r\n\r\n### Sets or updates the archive configuration\r\n* POST archive/tenant/{tenant_uuid}/configuration\r\n    * parameters\r\n        * Request Body JSON parameters\r\n            * maximumNumberOfEvents - Maximum number of events to retain (Default=-1)\r\n            * maximumNumberOfStoredEventsDays - Maximum numbers of days of events to retain (Default=-1)\r\n\r\n* Sample Request\r\n```\r\n{\r\n  \"maximumNumberOfEvents\": 100,\r\n  \"maximumNumberOfStoredEventsDays\": 30\r\n}\r\n```\r\n\r\n### Get archive list\r\n* GET archive/tenant/{tenant_uuid}/archives\r\n    * parameters\r\n            * tenant_uuid - tenant uuid (primary event grouping)\r\n\r\n* Sample Response Payload\r\n```\r\n\"payload\" : [\r\n    {\r\n      \"id\": 11,\r\n      \"uuid\": \"e006f214-88a6-424b-9a7d-f43180aba455\",\r\n      \"tenantUuid\": \"4b2b0ad4-c54b-4e69-90b1-12d73e36662c\",\r\n      \"fromDate\": 1461800406677,\r\n      \"toDate\": 1461865172861,\r\n      \"size\": 20\r\n    }]\r\n```\r\n\r\n### Get staged events\r\n* PUT archive/tenant/{tenant_uuid}/staged-events\r\n    * URI path parameters\r\n        * tenant_uuid - tenant uuid (primary event grouping)\r\n* Sample Response Payload\r\n```\r\n  \"payload\": [\r\n    {\r\n      \"id\": 12,\r\n      \"uuid\": \"0730853b-6a5b-4894-b6da-e7e88833f1e9\",\r\n      \"tenantUuid\": null,\r\n      \"context\": \"user test\",\r\n      \"tag\": \"group2\",\r\n      \"classification\": 0,\r\n      \"enabled\": true,\r\n      \"timestamp\": 1459378121815,\r\n      \"lastUpdated\": 1459378121815,\r\n      \"data\": \"{\\\"name\\\": \\\"test1.csv\\\"}\"\r\n    },\r\n  ],\r\n  \"uuid\": \"ddc7f50a-6883-45aa-a823-b70e47d2a05c\",\r\n  \"status\": 1000,\r\n  \"message\": \"OK\",\r\n  \"timestamp\": 1459470908881\r\n```\r\n\r\n### Get archive by uuid\r\n* PUT archive/tenant/{tenant_uuid}/archives/{uuid}\r\n    * URI path parameters\r\n        * tenant_uuid - tenant uuid (primary event grouping)\r\n        * uuid - uuid of the archive (REQUIRED)\r\n* Sample Response Payload\r\n```\r\n  \"payload\": [\r\n    {\r\n      \"id\": 12,\r\n      \"uuid\": \"0730853b-6a5b-4894-b6da-e7e88833f1e9\",\r\n      \"tenantUuid\": null,\r\n      \"context\": \"user test\",\r\n      \"tag\": \"group2\",\r\n      \"classification\": 0,\r\n      \"enabled\": true,\r\n      \"timestamp\": 1459378121815,\r\n      \"lastUpdated\": 1459378121815,\r\n      \"data\": \"{\\\"name\\\": \\\"test1.csv\\\"}\"\r\n    },\r\n  ],\r\n  \"uuid\": \"ddc7f50a-6883-45aa-a823-b70e47d2a05c\",\r\n  \"status\": 1000,\r\n  \"message\": \"OK\",\r\n  \"timestamp\": 1459470908881\r\n```\r\n\r\n## Response codes\r\nThese are the service-specific responses embedded in service responses\r\n\r\n* **1000** - OK\r\n* **1001** - Event does not exist\r\n* **1002** - Event Owner does not exist\r\n* **1003** - Event Tenant does not exist\r\n* **1004** - Event Owner is missing or blank\r\n* **1005** - Encountered exception adding events\r\n* **1006** - Tenant ID mismatch\r\n* **1007** - Tenant is missing or blank\r\n* **1008** - Search query is missing or blank\r\n* **1009** - Invalid search query string\r\n* **1101** - The archive does not exist\r\n\r\n\r\n## Resources\r\n\r\n* [Event Audit Trail SDK](https://github.build.ge.com/emerging-verticals/event-audit-trail-sdk) - The accompanying SDK for the event audit-trail.\r\n\r\n* [Event Audit Trail Sample Application](https://github.build.ge.com/emerging-verticals/event-audit-trail-sample) - A sample application which utilizes the Event Audit Trail Service\r\n\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}